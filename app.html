<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TareaPorHacer • Tablero</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="/css/styles.css" rel="stylesheet">
</head>
<body>
  <nav class="navbar navbar-expand-lg border-bottom is-gradient">
    <div class="container-fluid">
      <span class="navbar-brand text-white">TareaPorHacer</span>
      <div class="d-flex gap-2">
        <button class="btn btn-outline-light" id="btnSeed"><i class="bi bi-download"></i> Cargar tareas iniciales</button>
        <button class="btn btn-outline-light" id="btnLogout"><i class="bi bi-box-arrow-right"></i> Salir</button>
      </div>
    </div>
  </nav>

  <main class="container py-4">
    <div class="row g-3 align-items-center mb-3">
      <div class="col">
        <div class="section-title">
          <h1 class="h4 mb-0">Tablero colaborativo</h1>
          <span class="hint"><i class="bi bi-arrows-move"></i> Arrastra tus tareas entre columnas</span>
        </div>
        <small class="text-muted" id="currentUser"></small>
      </div>
      <div class="col-auto">
        <button class="btn btn-primary" id="btnNewTask"><i class="bi bi-plus-circle"></i> Nueva tarea</button>
      </div>
    </div>

    <section class="row g-3 mb-3" id="statsArea">
    </section>

    <section class="row g-3" id="kanban">
      <div class="col-12 col-md-4">
        <div class="card h-100">
          <div class="card-header fw-semibold">Pendiente</div>
          <div class="card-body vstack gap-2 droptarget" data-estado="pendiente" id="col-pendiente"></div>
        </div>
      </div>
      <div class="col-12 col-md-4">
        <div class="card h-100">
          <div class="card-header fw-semibold">En progreso</div>
          <div class="card-body vstack gap-2 droptarget" data-estado="en_progreso" id="col-en_progreso"></div>
        </div>
      </div>
      <div class="col-12 col-md-4">
        <div class="card h-100">
          <div class="card-header fw-semibold">Completada</div>
          <div class="card-body vstack gap-2 droptarget" data-estado="completada" id="col-completada"></div>
        </div>
      </div>
    </section>
  </main>

  <div class="modal fade" id="taskModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="taskForm" class="needs-validation" novalidate>
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="taskModalLabel">Nueva tarea</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body vstack gap-3">
            <input type="hidden" id="taskId" />
            <div>
              <label class="form-label">Título</label>
              <input type="text" class="form-control" id="taskTitulo" required minlength="3">
              <div class="invalid-feedback">Ingresa un título válido (≥ 3 caracteres).</div>
            </div>
            <div>
              <label class="form-label">Descripción</label>
              <textarea class="form-control" id="taskDescripcion" rows="3"></textarea>
            </div>
            <div>
              <label class="form-label">Asignado a</label>
              <select class="form-select" id="taskAsignadoA" required></select>
              <div class="invalid-feedback">Selecciona un usuario.</div>
            </div>
            <div>
              <label class="form-label">Vence en</label>
              <input type="date" class="form-control" id="taskVenceEn">
            </div>
            <div>
              <label class="form-label">Estado</label>
              <select class="form-select" id="taskEstado" required>
                <option value="pendiente">Pendiente</option>
                <option value="en_progreso">En progreso</option>
                <option value="completada">Completada</option>
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-primary">Guardar</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <template id="tpl-task-card">
    <div class="card task-card" draggable="true">
      <div class="card-body p-3">
        <div class="d-flex align-items-start justify-content-between gap-2">
          <div class="me-2 flex-grow-1">
            <h2 class="h6 mb-1 task-title"></h2>
            <p class="mb-2 small text-body-secondary task-desc"></p>
            <div class="d-flex flex-wrap gap-2 small">
              <span class="badge text-bg-light border assign-badge"></span>
              <span class="badge text-bg-light border due-badge"></span>
            </div>
          </div>
          <div class="btn-group btn-group-sm">
            <button class="btn btn-outline-primary btn-edit" title="Editar"><i class="bi bi-pencil-square"></i></button>
            <button class="btn btn-outline-danger btn-del" title="Borrar"><i class="bi bi-trash3"></i></button>
          </div>
        </div>
      </div>
    </div>
  </template>

  <template id="tpl-stat-card">
    <div class="col-12 col-md-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <div class="stat-title fw-semibold"></div>
              <div class="stat-sub text-muted small"></div>
            </div>
            <div class="display-6 mb-0 stat-value"></div>
          </div>
        </div>
      </div>
    </div>
  </template>

  <div id="toastArea" class="position-fixed top-0 end-0 p-3" style="z-index:1080"></div>

  <script type="module">
    import { AppController } from './src/AppController.js';
    new AppController();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
